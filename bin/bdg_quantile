#!/bin/bash

if [ $# -lt 2 ];then
	echo0 5 "$0 in.bdg percetage_of_quantile [set any value to include 0 signal; default: not included]"
	exit 1
fi

if [ -z $3 ];then
	awk 'BEGIN{FS=OFS="\t"} {a[$4]+=($3-$2)} END{for(i in a){print i,a[i]}}' $1 | sort -k1,1nr | awk -v perc=$2 'BEGIN{FS=OFS="\t"} {if($1>0){sum+=$2};a[NR]=a[NR-1]+$2;b[NR]=$1} END{for(i=1;i<1000000000;i++){if(a[i]>sum/100*perc){print b[i];break}}}'
else
	awk 'BEGIN{FS=OFS="\t"} {a[$4]+=($3-$2)} END{for(i in a){print i,a[i]}}' $1 | sort -k1,1nr | awk -v perc=$2 'BEGIN{FS=OFS="\t"} {sum+=$2;a[NR]=a[NR-1]+$2;b[NR]=$1} END{for(i=1;i<1000000000;i++){if(a[i]>sum/100*perc){print b[i];break}}}'
fi
